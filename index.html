<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>alexxxsss // from the void</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ------------------- */
        /* --- THEME VARIABLES --- */
        /* ------------------- */
        :root {
            /* Default: Midnight Dark Mode */
            --bg-color: #0d0f14; /* A very dark, desaturated midnight blue */
            --primary-color: #b30000;
            --secondary-color: #b9c1d1; /* A cooler grey to match the blue tone */
            --text-color: #98a0b3;
            --dark-grey: #191c23;   /* A slightly lighter blue-grey for cards */
            --card-bg-color: rgba(25, 28, 35, 0.7); /* Corresponds to the new --dark-grey */
            --card-border-color: rgba(179, 0, 0, 0.2);
            --card-hover-border-color: rgba(179, 0, 0, 0.7);
            --blob-color: #20242d; /* A subtle, lighter blue-grey for blobs */
        }

        body.light-mode {
            /* Light Mode Overrides */
            --bg-color: #dcdcdc;
            --primary-color: #b30000;
            --secondary-color: #1a1a1a;
            --text-color: #333333;
            --dark-grey: #f0f0f0;
            --card-bg-color: rgba(240, 240, 240, 0.7);
            --card-border-color: rgba(179, 0, 0, 0.2);
            --card-hover-border-color: rgba(179, 0, 0, 0.7);
            --blob-color: #c0c0c0;
        }

        /* ------------------- */
        /* --- GLOBAL STYLES --- */
        /* ------------------- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto Mono', monospace;
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            background-image: 
                radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%),
                url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%" height="100%" filter="url(%23noise)" opacity="0.03"/%3E%3C/svg%3E');
            cursor: none;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; position: relative; z-index: 2; }
        h1, h2, h3 { font-family: 'Chakra Petch', sans-serif; text-transform: uppercase; letter-spacing: 3px; color: var(--primary-color); text-shadow: 0 0 8px var(--primary-color); }
        h2 { text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--secondary-color); text-shadow: 0 0 5px var(--secondary-color); }
        h3 { color: var(--secondary-color); font-size: 1.2rem; margin-bottom: 1rem; }
        a { color: var(--primary-color); text-decoration: none; transition: all 0.3s ease; }
        a:hover { color: var(--secondary-color); text-shadow: 0 0 8px var(--secondary-color); }
        
        .hidden { display: none !important; }

        /* ------------------- */
        /* --- THEME TOGGLE BUTTON --- */
        /* ------------------- */
        #theme-toggle { position: fixed; top: 20px; right: 20px; z-index: 1000; background: none; border: 1px solid var(--secondary-color); color: var(--secondary-color); width: 40px; height: 40px; padding: 8px; cursor: none; transition: all 0.3s ease; }
        #theme-toggle:hover { border-color: var(--primary-color); color: var(--primary-color); }
        #theme-toggle svg { width: 100%; height: 100%; fill: currentColor; }

        /* ------------------- */
        /* --- BACKGROUND BLOBS --- */
        /* ------------------- */
        .background-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; overflow: hidden; }
        .background-blobs svg { position: absolute; fill: var(--blob-color); opacity: 0.5; filter: blur(80px); animation: drift 80s infinite linear alternate; transition: fill 0.3s ease; }
        .blob1 { top: -20vh; left: -10vw; width: 50vw; animation-duration: 80s; }
        .blob2 { top: 10vh; right: -20vw; width: 60vw; animation-duration: 120s; }
        .blob3 { bottom: -30vh; left: 10vw; width: 40vw; animation-duration: 95s; }
        .blob4 { bottom: -10vh; right: 0vw; width: 45vw; animation-duration: 70s; }
        @keyframes drift {
            from { transform: rotate(0deg) translateX(20px) translateY(20px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(-20px) translateY(-20px) rotate(-360deg); }
        }

        /* ------------------- */
        /* --- HERO & CORRUPTED TEXT EFFECT --- */
        /* ------------------- */
        .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; margin-bottom: 4rem; }
        .corrupted-wrapper { animation: flickerIn 1s ease-in forwards; opacity: 0; }
        h1.corrupted-text { font-size: 6rem; font-weight: 700; color: var(--primary-color); text-shadow: 0 0 5px var(--primary-color), 0 0 15px rgba(179, 0, 0, 0.5); letter-spacing: 5px; }
        .hero p { font-size: 1.5rem; margin-top: 1rem; color: var(--text-color); letter-spacing: 2px; animation: fadeIn 1s ease-in 0.5s forwards; opacity: 0; }
        @keyframes flickerIn { 0% { opacity: 0; } 10%, 20%, 40%, 60%, 80% { opacity: 0.5; text-shadow: 0 0 15px var(--secondary-color); } 15%, 25%, 45%, 65%, 85% { opacity: 0.2; text-shadow: none; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* SCROLL-TRIGGERED ANIMATIONS */
        .fade-in-section { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }

        /* ------------------- */
        /* --- NEW CARD LAYOUT SYSTEM --- */
        /* ------------------- */
        .card-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .content-card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            padding: 2.5rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .content-card:hover {
            border-color: var(--card-hover-border-color);
            box-shadow: 0 0 20px rgba(179, 0, 0, 0.3);
        }

        /* CARD 1: ABOUT */
        #about-card p { text-align: center; max-width: 700px; margin: 0 auto; font-size: 1.1rem; }
        
        /* CARD 2: MUSIC STATS */
        #now-playing {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem;
            background-color: rgba(0,0,0,0.2);
            border: 1px dashed var(--card-border-color);
            margin-bottom: 2rem;
        }
        #now-playing-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--primary-color);
        }
        #now-playing.is-listening #now-playing-status::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--primary-color); } 70% { box-shadow: 0 0 0 10px rgba(179,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(179,0,0,0); } }

        #now-playing img { width: 80px; height: 80px; }
        #now-playing-info { flex: 1; }
        #now-playing-info .track { font-weight: bold; color: var(--secondary-color); font-size: 1.2rem; }
        #now-playing-info .artist { color: var(--text-color); }
        
        .spotify-stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        .music-list { list-style: none; counter-reset: item; }
        .music-list li {
            display: flex;
            align-items: center; /* <<< CHANGED */
            gap: 1rem;           /* <<< ADDED */
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 0.8rem;
            margin-bottom: 0.8rem; /* <<< ADDED for spacing */
        }
        .music-list li::before {
            content: counter(item, decimal-leading-zero) ".";
            counter-increment: item;
            color: var(--primary-color);
            font-weight: bold;
            min-width: 25px;
        }
        /* <<< --- NEW CSS FOR IMAGES --- >>> */
        .music-list img {
            width: 50px;
            height: 50px;
            object-fit: cover; /* Prevents image stretching */
            background-color: var(--dark-grey); /* Placeholder color */
        }
        .list-item-info a { color: var(--secondary-color); }
        .list-item-info span { font-size: 0.8rem; color: var(--text-color); display: block; }
        
        /* CARD 3: GAMES */
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; }
        .game-card { background: var(--dark-grey); border: 1px solid #222; padding: 1.5rem; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease; }
        .game-card:hover { transform: translateY(-10px); border-color: var(--primary-color); box-shadow: 0 0 15px rgba(179, 0, 0, 0.5); }
        .game-card-image { width: 100%; height: 180px; background-color: var(--bg-color); margin-bottom: 1rem; color: #444; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; border: 1px dashed var(--secondary-color); transition: background-color 0.3s ease; }
        .game-card h3 { font-family: 'Chakra Petch', sans-serif; color: var(--primary-color); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .game-card-links { margin-top: 1rem; }
        .game-card-links a { margin-right: 1rem; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; border: 1px solid var(--secondary-color); color: var(--secondary-color); padding: 0.3rem 0.7rem; display: inline-block; margin-bottom: 0.5rem;}
        .game-card-links a:hover { background: var(--secondary-color); color: var(--bg-color); box-shadow: 0 0 10px var(--secondary-color); }

        /* CONTACT & HOVER ANIMATION */
        .contact-links { text-align: center; }
        .contact-links a { font-size: 2rem; margin: 0 1.5rem; display: inline-block; }
        .contact-links a:hover { animation: static-flicker 0.2s infinite steps(1); }
        @keyframes static-flicker { 0%, 100% { opacity: 1; color: var(--secondary-color); text-shadow: 0 0 8px var(--secondary-color); } 25% { opacity: 0.8; } 50% { opacity: 1; color: var(--primary-color); } 75% { opacity: 0.7; } }
        
        footer { text-align: center; padding: 2rem; margin-top: 2rem; color: #444; border-top: 1px solid #222; }
        
        /* EMO CURSOR */
        .emo-cursor { width: 30px; height: 30px; position: fixed; top: 0; left: 0; transform: translate(-50%, -50%); pointer-events: none; z-index: 9999; transition: transform 0.1s ease-out; }
        .emo-cursor::before, .emo-cursor::after { content: ''; position: absolute; top: 50%; left: 50%; width: 100%; height: 2px; background-color: var(--primary-color); box-shadow: 0 0 5px var(--primary-color); }
        .emo-cursor::before { transform: translate(-50%, -50%) rotate(45deg); }
        .emo-cursor::after { transform: translate(-50%, -50%) rotate(-45deg); }
        
        /* RESPONSIVE */
        @media (max-width: 768px) { 
            h1.corrupted-text { font-size: 3.5rem; } 
            .hero p { font-size: 1.2rem; } 
            h2 { font-size: 2rem; } 
            .background-blobs svg { filter: blur(60px); }
            .content-card { padding: 1.5rem; }
            .spotify-stats-container { grid-template-columns: 1fr; }
            #now-playing { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <!-- (HTML body content is unchanged from previous version) -->
    <button id="theme-toggle" title="Toggle theme">
        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.836 17.894a.75.75 0 011.06 0l1.59 1.59a.75.75 0 01-1.06 1.06l-1.59-1.59a.75.75 0 010-1.06zM12 18.75a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM5.106 17.836a.75.75 0 010-1.06l1.59-1.591a.75.75 0 111.06 1.06l-1.59 1.59a.75.75 0 01-1.06 0zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM6.106 5.106a.75.75 0 011.06 0l1.591 1.59a.75.75 0 01-1.06 1.06l-1.59-1.59a.75.75 0 010-1.06z"></path></svg>
        <svg id="moon-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.48 2.512a.75.75 0 01.442 1.217 9.752 9.752 0 005.42 5.42.75.75 0 011.218.442 9.75 9.75 0 01-11.258 11.258.75.75 0 01-.442-1.218 9.752 9.752 0 00-5.42-5.42.75.75 0 01-.442-1.218A9.75 9.75 0 0111.48 2.512z"></path></svg>
    </button>
    <div class="emo-cursor"></div>
    <div class="background-blobs">
        <svg class="blob1" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><path d="M432.5,302.5Q420,355,379,396.5Q338,438,284,453.5Q230,469,183.5,444.5Q137,420,95,385.5Q53,351,46,299.5Q39,248,68,198.5Q97,149,139.5,116Q182,83,232.5,60.5Q283,38,333,59.5Q383,81,412.5,129.5Q442,178,442.5,214Q443,250,432.5,302.5Z"></path></svg>
        <svg class="blob2" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><path d="M421,289.5Q380,329,363,380.5Q346,432,286,442Q226,452,178,421Q130,390,95.5,355.5Q61,321,57,268.5Q53,216,77.5,167Q102,118,145.5,88Q189,58,241.5,49.5Q294,41,349,61Q404,81,429.5,130Q455,179,443,214.5Q431,250,421,289.5Z"></path></svg>
        <svg class="blob3" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><path d="M399.5,296Q362,342,339,388Q316,434,260.5,437Q205,440,165.5,406.5Q126,373,95.5,335Q65,297,55,248.5Q45,200,81.5,159.5Q118,119,161,101.5Q204,84,256,71Q308,58,353,88Q398,118,418,162Q438,206,418.5,251Q399.5,296,399.5,296Z"></path></svg>
        <svg class="blob4" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"><path d="M422,308.5Q424,367,372.5,389.5Q321,412,277,427.5Q233,443,186,427Q139,411,105,376.5Q71,342,65,295Q59,248,77,199.5Q95,151,139,127Q183,103,230.5,91Q278,79,335.5,89Q393,99,417.5,148.5Q442,198,420,253Q398,308,422,308.5Z"></path></svg>
    </div>
    <div class="container">
        <header class="hero">
            <div class="corrupted-wrapper">
                <h1 class="corrupted-text" data-value="alexxxsss">alexxxsss</h1>
            </div>
            <p>indie dev crafting experiences from the void</p>
        </header>
        <main>
            <div class="card-container">
                <article id="about-card" class="content-card fade-in-section">
                    <h2>[:: About Me ::]</h2>
                    <p>I'm alexxxsss, a solo developer from the digital abyss. I build games that are a little weird, a little loud, and full of static. Inspired by forgotten technology, punk rock, and fever dreams, my goal is to create alternative worlds you can get lost in.</p>
                </article>
                <article id="music-card" class="content-card fade-in-section">
                    <h2>[:: Music Stats ::]</h2>
                    <div id="now-playing">
                       <p>Contacting the mothership...</p>
                    </div>
                    <div class="spotify-stats-container">
                        <div id="top-tracks-container">
                            <h3>Top Tracks (7 days)</h3>
                            <ul id="top-tracks-list" class="music-list"><li>Loading...</li></ul>
                        </div>
                        <div id="top-artists-container">
                            <h3>Top Artists (7 days)</h3>
                            <ul id="top-artists-list" class="music-list"><li>Loading...</li></ul>
                        </div>
                    </div>
                </article>
                <article id="games-card" class="content-card fade-in-section">
                    <h2>[:: My Games ::]</h2>
                    <div class="games-grid">
                        <div class="game-card">
                            <div class="game-card-image">[ Your Game GIF/Image Here ]</div>
                            <h3>Void Scrapper</h3>
                            <p>A fast-paced roguelike where you navigate a collapsing reality. Glitchy visuals, killer soundtrack, and unforgiving gameplay.</p>
                            <div class="game-card-links">
                                <a href="#" target="_blank">Play It</a> 
                                <a href="#" target="_blank">Source</a>
                            </div>
                        </div>
                        <div class="game-card">
                            <div class="game-card-image">[ Your Game GIF/Image Here ]</div>
                            <h3>Chroma Bleed</h3>
                            <p>A narrative-driven puzzle game about a runaway artist painting their way out of a monochrome world. Emo vibes guaranteed.</p>
                            <div class="game-card-links">
                                <a href="#" target="_blank">Wishlist</a> 
                                <a href="#" target="_blank">Devlog</a>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
            <section id="contact" class="fade-in-section">
                <h2>[:: Find Me ::]</h2>
                <div class="contact-links">
                    <a href="#" target="_blank" title="Twitter">TW</a>
                    <a href="#" target="_blank" title="Itch.io">IO</a>
                    <a href="#" target="_blank" title="GitHub">GH</a>
                    <a href="mailto:youremail@example.com" title="Email">EM</a>
                </div>
            </section>
        </main>
        <footer>
            <p class="fade-in-section">&copy; 2024 alexxxsss. Built from scratch with pixels and angst.</p>
        </footer>
    </div>

<script>
    // --- CORRUPTED TEXT EFFECT SCRIPT --- (This is unchanged)
    const corruptedText = document.querySelector('.corrupted-text');
    const originalText = corruptedText.dataset.value;
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const symbols = "!<>-_\\/[]{}—=+*^?#_";
    let interval = null;

    function scramble() {
        let iteration = 0;
        clearInterval(interval);
        interval = setInterval(() => {
            corruptedText.innerText = originalText
                .split("").map((letter, index) => {
                    if (index < iteration) return originalText[index];
                    return Math.random() < 0.6 ? letters[Math.floor(Math.random() * 26)] : symbols[Math.floor(Math.random() * symbols.length)];
                }).join("");
            if (iteration >= originalText.length) clearInterval(interval);
            iteration += 1 / 3;
        }, 30);
    }
    setInterval(scramble, 5000);
    scramble();

    // --- THEME TOGGLE SCRIPT --- (This is unchanged)
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    const body = document.body;
    function applyTheme(theme) { if (theme === 'light') { body.classList.add('light-mode'); sunIcon.classList.add('hidden'); moonIcon.classList.remove('hidden'); } else { body.classList.remove('light-mode'); sunIcon.classList.remove('hidden'); moonIcon.classList.add('hidden'); } }
    const savedTheme = localStorage.getItem('theme');
    applyTheme(savedTheme || 'dark');
    themeToggle.addEventListener('click', () => { const isLight = body.classList.toggle('light-mode'); const currentTheme = isLight ? 'light' : 'dark'; sunIcon.classList.toggle('hidden', isLight); moonIcon.classList.toggle('hidden', !isLight); localStorage.setItem('theme', currentTheme); });

    // --- CUSTOM CURSOR SCRIPT --- (This is unchanged)
    const cursor = document.querySelector(".emo-cursor");
    window.addEventListener("mousemove", function (e) { cursor.style.left = `${e.clientX}px`; cursor.style.top = `${e.clientY}px`; });

    // --- SCROLL ANIMATION SCRIPT --- (This is unchanged)
    const observer = new IntersectionObserver((entries) => { entries.forEach((entry) => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); } }); });
    const sectionsToAnimate = document.querySelectorAll('.fade-in-section');
    sectionsToAnimate.forEach((el) => observer.observe(el));

    // --- LAST.FM API SCRIPT --- (THIS IS THE PART WE ARE FIXING)
    document.addEventListener('DOMContentLoaded', () => {
        const apiKey = 'ab6a26baf647f8b63f8c236d13e882bc';
        const username = 'Alekxsses';
        const nowPlayingEl = document.getElementById('now-playing');
        const topTracksListEl = document.getElementById('top-tracks-list');
        const topArtistsListEl = document.getElementById('top-artists-list');

        const fetchFromLastFM = async (params) => {
            const url = new URL('https://ws.audioscrobbler.com/2.0/');
            url.search = new URLSearchParams({
                ...params,
                user: username,
                api_key: apiKey,
                format: 'json',
            });

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Error fetching from Last.fm:", error);
                return null;
            }
        };

        const renderNowPlaying = (data) => {
            if (!data?.recenttracks?.track?.[0]) {
                nowPlayingEl.innerHTML = '<p>Could not load recent track.</p>';
                return;
            }
            const track = data.recenttracks.track[0];
            const isNowPlaying = track['@attr']?.nowplaying === 'true';
            // Important: Now Playing *does* include images, so this logic is fine
            const imageUrl = track.image.find(img => img.size === 'large')?.['#text'] || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

            nowPlayingEl.innerHTML = `
                <img src="${imageUrl}" alt="Album art for ${track.name}">
                <div id="now-playing-info">
                    <div id="now-playing-status">${isNowPlaying ? 'Now Playing' : 'Recently Played'}</div>
                    <div class="track"><a href="${track.url}" target="_blank" rel="noopener noreferrer">${track.name}</a></div>
                    <div class="artist">${track.artist['#text']}</div>
                </div>
            `;
            if (isNowPlaying) nowPlayingEl.classList.add('is-listening');
        };

        // --- NEW FUNCTION FOR TOP TRACKS ---
        const renderTopTracks = async () => {
            // Step 1: Get the list of top tracks
            const listData = await fetchFromLastFM({ method: 'user.gettoptracks', period: '7day', limit: 5 });
            if (!listData?.toptracks?.track) {
                topTracksListEl.innerHTML = '<li>Could not load top tracks.</li>';
                return;
            }

            // Step 2: Create promises to fetch detailed info for each track
            const trackInfoPromises = listData.toptracks.track.map(track =>
                fetchFromLastFM({ method: 'track.getInfo', artist: track.artist.name, track: track.name })
            );
            
            // Step 3: Wait for all detailed info to be fetched
            const trackInfos = await Promise.all(trackInfoPromises);

            // Step 4: Build the HTML using the detailed info
            const html = trackInfos.map((info, index) => {
                if (!info?.track) return ''; // Skip if a fetch failed
                const originalTrack = listData.toptracks.track[index];
                const track = info.track;
                // Get image from the detailed `track.album` object
                const imageUrl = track.album?.image.find(i => i.size === 'large')?.['#text'] || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

                return `
                    <li>
                        <img src="${imageUrl}" alt="Album art for ${track.name}">
                        <div class="list-item-info">
                            <a href="${track.url}" target="_blank" rel="noopener noreferrer">${track.name}</a>
                            <span>${parseInt(originalTrack.playcount).toLocaleString()} plays</span>
                        </div>
                    </li>
                `;
            }).join('');
            topTracksListEl.innerHTML = html || '<li>No top tracks found.</li>';
        };
        
        // --- NEW FUNCTION FOR TOP ARTISTS ---
        const renderTopArtists = async () => {
             // Step 1: Get the list of top artists
            const listData = await fetchFromLastFM({ method: 'user.gettopartists', period: '7day', limit: 5 });
            if (!listData?.topartists?.artist) {
                topArtistsListEl.innerHTML = '<li>Could not load top artists.</li>';
                return;
            }

            // Step 2: Create promises to fetch detailed info for each artist
            const artistInfoPromises = listData.topartists.artist.map(artist =>
                fetchFromLastFM({ method: 'artist.getInfo', artist: artist.name })
            );

            // Step 3: Wait for all detailed info to be fetched
            const artistInfos = await Promise.all(artistInfoPromises);

            // Step 4: Build the HTML using the detailed info
            const html = artistInfos.map((info, index) => {
                if (!info?.artist) return ''; // Skip if a fetch failed
                const originalArtist = listData.topartists.artist[index];
                const artist = info.artist;
                // Get image directly from the detailed artist object
                const imageUrl = artist.image.find(i => i.size === 'large')?.['#text'] || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

                return `
                    <li>
                        <img src="${imageUrl}" alt="Image for ${artist.name}">
                        <div class="list-item-info">
                            <a href="${artist.url}" target="_blank" rel="noopener noreferrer">${artist.name}</a>
                            <span>${parseInt(originalArtist.playcount).toLocaleString()} plays</span>
                        </div>
                    </li>
                `;
            }).join('');
            topArtistsListEl.innerHTML = html || '<li>No top artists found.</li>';
        };

        const loadMusicData = async () => {
            // Fetch Now Playing first, as it's a single quick call
            const recent = await fetchFromLastFM({ method: 'user.getrecenttracks', limit: 1 });
            renderNowPlaying(recent);

            // Now, trigger the functions that handle the multi-step fetching for lists.
            // We don't need to wait for them to finish, they will update the page when they are done.
            renderTopTracks();
            renderTopArtists();
        };

        loadMusicData();
    });
</script>
</body>
</html>
